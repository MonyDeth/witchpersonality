<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="/favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lexend+Deca:wght@100..900&display=swap" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet"/>
    <title>A Witch's Stop Personality Test</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>

    <style>
        #initial-loader {
            position: fixed;
            inset: 0;
            background-color: #00256E;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 99999;
            overflow: hidden;
            color: white;
            font-family: 'Lexend Deca', sans-serif;
        }

        .loader-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 250px;
        }

        .loading-logo {
            width: 200px;
            height: auto;
            opacity: 0;
            margin-bottom: 30px;
        }

        /* Actual Progress Container */
        .progress-container {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .progress-bar-bg {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }

        .progress-fill {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 0%; /* Controlled by JS */
            background: #FFFFFF;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
            transition: width 0.3s ease-out;
        }

        .progress-text, .loading-status {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 600;
        }

        .loading-status {
            margin-top: 5px;
            height: 1rem; /* Prevent layout jump when text changes */
        }

        @media (max-width: 768px) {
            .loading-logo { width: 140px; }
            .loader-content { width: 180px; }
        }
    </style>
</head>
<body>
<div id="initial-loader">
    <div class="loader-content">
        <img id="loader-logo" src="/src/assets/Nompang-Studios-Full-White.webp" alt="Nompang Studios" class="loading-logo">

        <div class="progress-container">
            <div class="progress-bar-bg">
                <div id="progress-fill" class="progress-fill"></div>
            </div>
            <div class="progress-text"><span id="perc">0</span>%</div>
            <div id="status-text" class="loading-status">Mixing Ingredients...</div>
        </div>
    </div>
</div>

<div id="app"></div>

<script>
    (function() {
        const fill = document.getElementById('progress-fill');
        const percText = document.getElementById('perc');
        const statusText = document.getElementById('status-text');
        const loader = document.getElementById('initial-loader');

        // Check if returning user
        if (localStorage.getItem('nompang_has_visited')) {
            loader.style.display = 'none';
            return;
        }

        // 1. Initial Logo Fade In
        gsap.to("#loader-logo", { opacity: 1, duration: 1, ease: "power2.out" });

        // 2. Track Loading Progress
        // We simulate the progress based on internal browser loading events
        let progress = 0;
        const interval = setInterval(() => {
            // Incremental progress while waiting for 'window.load'
            if (progress < 90) {
                progress += Math.random() * 15;
                if (progress > 90) progress = 90;
                updateUI(Math.floor(progress));
            }
        }, 400);

        function updateUI(val) {
            fill.style.width = val + '%';
            percText.innerText = val;
        }

        window.addEventListener('load', function() {
            clearInterval(interval);
            updateUI(100);
            statusText.innerText = "Good to brew!";
            statusText.style.color = "#FFFFFF"; // Minty green success color

            // 3. Final Transition
            const tl = gsap.timeline({
                delay: 0.8, // Let them read "Good to brew!"
                onComplete: () => {
                    loader.remove();
                    localStorage.setItem('nompang_has_visited', 'true');
                    window.dispatchEvent(new Event('loaderFinished'));
                }
            });

            tl.to("#loader-logo", {
                filter: "drop-shadow(0 0 25px rgba(255, 255, 255, 0.9))",
                scale: 1.05,
                duration: 0.6
            })
                .to("#initial-loader", {
                    yPercent: -100,
                    duration: 1.2,
                    ease: "power4.inOut"
                });
        });
    })();
</script>

<script type="module" src="/src/main.js"></script>
</body>
</html>